<template>
  <header
    v-if="pages"
    ref="root$"
    class="sticky z-50 mt-0 flex items-center justify-between gap-x-16 rounded-8 bg-white p-16 text-left transition-[border-radius,opacity,box-shadow]"
    :class="[{
      'top-16 mx-16': true,
      'shadow': localState.isScrolled,
      'rounded-br-0': localState.isGetStartedModalVisible,
      'pointer-events-none opacity-0': localState.isScrolled,
      'pointer-events-auto !opacity-100 shadow': localState.isSticky,
      'mb-32': pages.length > 0
    }, `bg-${backgroundColor}`]"
  >
    <nuxt-link
      class="nuxt-link-active opacity-100 transition-opacity hover:opacity-70 focus:opacity-70"
      to="/"
    >
      <svg
        class="h-32 shrink-0"
        viewBox="0 0 810 151"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      ><path
        d="M801.42 64.21a8.704 8.704 0 0 1-3.39-.68 8.211 8.211 0 0 1-4.51-4.52 8.25 8.25 0 0 1-.68-3.38 8.673 8.673 0 0 1 .68-3.39 7.58 7.58 0 0 1 1.8-2.71 8.828 8.828 0 0 1 2.68-1.85 8.312 8.312 0 0 1 3.39-.68 8.452 8.452 0 0 1 7.91 5.2 8.232 8.232 0 0 1 .68 3.39 8.588 8.588 0 0 1-.68 3.38 8.846 8.846 0 0 1-1.81 2.72 8.66 8.66 0 0 1-2.71 1.8 8.307 8.307 0 0 1-3.36.72Zm0-1.24a7.886 7.886 0 0 0 2.83-.57 6.33 6.33 0 0 0 2.26-1.58 6.987 6.987 0 0 0 1.46-2.26 7.773 7.773 0 0 0 .57-2.82 7.322 7.322 0 0 0-.57-2.82 6.338 6.338 0 0 0-1.46-2.26 6.05 6.05 0 0 0-2.26-1.47 7.285 7.285 0 0 0-5.65 0 7.808 7.808 0 0 0-2.26 1.47 5.91 5.91 0 0 0-1.47 2.26 7.81 7.81 0 0 0-.56 2.82c-.001.968.19 1.927.56 2.82a6.515 6.515 0 0 0 1.47 2.26 8.137 8.137 0 0 0 2.26 1.58c.9.35 1.856.529 2.82.53v.04Zm-3.61-2.37v-9.87h4.29a3.332 3.332 0 0 1 2.49.79 2.896 2.896 0 0 1 .9 2.15 2.484 2.484 0 0 1-.9 2c-.341.252-.723.442-1.13.56.22.12.33.12.45.23.399.36.676.836.79 1.36l.9 2.71h-2.26l-.9-2.94c-.11-.34-.23-.57-.56-.68a1.708 1.708 0 0 0-.8-.22h-1v3.72h-2.26l-.01.19Zm2.26-5.43h1.69c.439.03.875-.086 1.24-.33.28-.259.446-.618.46-1a1.125 1.125 0 0 0-.46-1 1.82 1.82 0 0 0-1.24-.34h-1.69v2.67ZM201.68 102.681v-54.55h10.05V72.3h.11l23.84-24.17h12.08l-26.32 26.21 28.13 28.34h-12.43l-25.3-25.3h-.11v25.3h-10.05ZM258.149 102.681v-54.55h23.85c6 0 10.62 1.47 13.9 4.29 3.28 2.82 5 6.78 5 11.86a15.995 15.995 0 0 1-2.26 8.59 14.202 14.202 0 0 1-6.33 5.42c-.84.371-1.709.672-2.6.9a9.425 9.425 0 0 1 2.38 1.13 12.309 12.309 0 0 1 4.17 5.2l8 17.16h-11l-8-17.73a5.807 5.807 0 0 0-3.28-3.61 14.757 14.757 0 0 0-5.31-.91h-8.47v22.14h-10.05v.11Zm10.05-29.59h12.2c3.5 0 6.21-.79 8-2.26a8.99 8.99 0 0 0 2.708-6.435 9 9 0 0 0-2.708-6.435c-1.81-1.47-4.52-2.15-8-2.15h-12.2v17.28ZM328.289 102.681v-22.92l-21.35-31.63h11.53l15 23.16 15-23.16h11.18l-21.35 31.74v22.81h-10.01ZM368.73 102.681v-54.55H393c6 0 10.62 1.47 13.67 4.29 3.05 2.82 4.74 6.89 4.74 12s-1.58 9-4.74 12-7.68 4.4-13.67 4.4h-14.22v22h-10l-.05-.14Zm9.94-29.93h13.1c3.27 0 5.76-.79 7.45-2.26a8.999 8.999 0 0 0 0-12.42c-1.69-1.47-4.18-2.26-7.45-2.26h-13.1v16.94ZM434.349 102.871v-46.42h-18.07v-8.24h46.08v8.24h-18.07v46.42h-9.94ZM467 75.35a32.336 32.336 0 0 1 3.16-14.91 22.767 22.767 0 0 1 9-9.71 27.661 27.661 0 0 1 14-3.5 26.65 26.65 0 0 1 14 3.5 23.085 23.085 0 0 1 9.15 9.71 32.193 32.193 0 0 1 3.16 14.8 33.804 33.804 0 0 1-3.16 14.91 24 24 0 0 1-9.15 9.82 29.697 29.697 0 0 1-28 0 23.05 23.05 0 0 1-9-9.82 33.657 33.657 0 0 1-3.16-14.8Zm10.5 0c0 6.1 1.36 11 4 14.46 2.64 3.46 6.55 5.19 11.74 5.19s8.93-1.69 11.75-5.19c2.82-3.5 4.06-8.25 4.06-14.46 0-6.21-1.35-11-4.06-14.46-2.71-3.46-6.66-5.08-11.75-5.08s-9.15 1.7-11.74 5.08-4.01 8.25-4.01 14.46h.01ZM549.89 103.481a40.53 40.53 0 0 1-12.08-1.7 28.696 28.696 0 0 1-9.49-4.63l3-7.79a38.744 38.744 0 0 0 5.53 3.16 27.603 27.603 0 0 0 6.1 1.92c2.268.46 4.577.688 6.89.68 4.07 0 7-.68 8.81-2a6.213 6.213 0 0 0 2.71-5.3 5.323 5.323 0 0 0-1.81-4.41c-1.24-1-3.5-1.81-6.66-2.48l-8.81-1.81c-5-1-8.81-2.71-11.29-5.2-2.48-2.49-3.73-5.64-3.73-9.71a15.135 15.135 0 0 1 2.71-8.92 17.388 17.388 0 0 1 7.57-5.88 29.413 29.413 0 0 1 11.45-2.2 33.001 33.001 0 0 1 10.74 1.69c3.053.98 5.862 2.6 8.24 4.75l-3 7.45a23.854 23.854 0 0 0-7.34-4.18 26.851 26.851 0 0 0-8.81-1.35c-3.62 0-6.55.67-8.58 2.14a6.848 6.848 0 0 0-3 5.88 5.75 5.75 0 0 0 1.92 4.51c1.24 1.13 3.38 2 6.43 2.6l8.7 1.7c5.2 1.013 9.04 2.707 11.52 5.08a12.481 12.481 0 0 1 3.73 9.49 14.865 14.865 0 0 1-2.6 8.58 17.568 17.568 0 0 1-7.45 5.76 28.926 28.926 0 0 1-11.4 2.17ZM594.17 102.681v-46.42H576.1v-8.24h46.08v8.24h-18.07v46.42h-9.94ZM619.469 102.681l24.73-54.55h8.36l25.07 54.55h-10.16l-5.54-12.65h-26.88l-5.53 12.65h-10.05Zm28.8-43.93-9.94 23.46h20.33l-10.17-23.49-.22.03ZM685.539 102.681v-54.55h19.88c6.21 0 11.52 1 15.81 3.16a22.338 22.338 0 0 1 9.83 9.27 29.804 29.804 0 0 1 3.39 14.79 29.672 29.672 0 0 1-3.39 14.68 22.57 22.57 0 0 1-9.83 9.38 35.154 35.154 0 0 1-15.81 3.27h-19.88Zm10.05-8.35h9.26c6.67 0 11.53-1.58 14.69-4.75s4.85-7.9 4.85-14.34c0-6.44-1.58-11.3-4.85-14.35-3.27-3.05-8.13-4.63-14.69-4.63h-9.26v38.07ZM756.131 102.681v-46.42h-18.07v-8.24h46.08v8.24h-18.07v46.42h-9.94Z"
        fill="#1D2348"
      /><path
        d="M89.46.11h41.68a27.263 27.263 0 0 1-7.987 19.343 27.28 27.28 0 0 1-19.343 7.987H62.24A27.18 27.18 0 0 1 89.46.11Z"
        fill="#FC8702"
      /><path
        d="M153.73 39.27c.11.23 20.78 36 20.78 36a27.246 27.246 0 0 1-30.357-1.944 27.239 27.239 0 0 1-7.023-8.056c-.12-.23-20.78-36-20.78-36a27.327 27.327 0 0 1 37.38 10Z"
        fill="#D94432"
      /><path
        d="M38.19 85.27c.11.23 20.78 36 20.78 36a27.251 27.251 0 0 1-37.39-10c-.11-.23-20.78-36-20.78-36a27.57 27.57 0 0 1 37.39 10Z"
        fill="#21BCA5"
      /><path
        d="M54.22 37.38c-.11.23-20.78 36-20.78 36a27.35 27.35 0 0 1-10-37.38c.11-.23 20.78-36 20.78-36a27.289 27.289 0 0 1 10 37.38Z"
        fill="#E9B213"
      /><path
        d="M151.92 114.52c-.11.23-20.78 36-20.78 36a27.36 27.36 0 0 1-8.027-7.04 27.36 27.36 0 0 1-5.412-20.232 27.357 27.357 0 0 1 3.439-10.108c.11-.23 20.78-36 20.78-36a27.324 27.324 0 0 1 13.445 27.272 27.319 27.319 0 0 1-3.445 10.108Z"
        fill="#1F2348"
      /><path
        d="M71.51 123.27h41.67a27.28 27.28 0 0 1-7.987 19.343A27.278 27.278 0 0 1 85.85 150.6H44.29a27.33 27.33 0 0 1 27.22-27.33Z"
        fill="#0582CA"
      /></svg>
    </nuxt-link>

    <ul
      class="hidden items-center gap-x-24 lg:flex"
    >
      <li
        v-for="item in pages"
        :key="String(item._modelApiKey)"
      >
        <TheLink
          v-if="item._modelApiKey !== 'home_page'"
          :text="item.navigationLabel"
          :link="'/' + item.navigationLabel"
          compact
          hide-arrow
        />
      </li>
      <li>
        <TheLink
          text="Contact"
          link="/contact"
          compact
          variant="info"
          hide-arrow
        />
      </li>
      <LocalizationDropdown />
    </ul>
  </header>
</template>

<script lang="ts" setup>
import { onMounted, onUnmounted } from 'vue'
import { useWebsiteStore } from '../store/store'

defineProps({
  backgroundColor: {
    type: String,
    default: 'white'
  }
})

const store = useWebsiteStore()
const pages = computed(() => store.pages)

// Code for hide/show navbar
const localState = reactive({
  selectedApp: 0,
  prevScrollPos: 0,
  isSticky: false,
  isScrolled: false,
  isGetStartedModalVisible: false,
  activeModal: 0
})

const root$ = ref(null)

function handleHeaderStyles () {
  const currentScrollPos = window.pageYOffset

  if (root$.value) {
    localState.isScrolled = currentScrollPos > 0
    localState.isSticky = currentScrollPos > 0 && localState.prevScrollPos > currentScrollPos
  }

  localState.prevScrollPos = currentScrollPos
}

function initHeader () {
  localState.prevScrollPos = window.pageYOffset
  handleHeaderStyles()

  if (root$.value) {
    document.addEventListener('scroll', handleHeaderStyles, {
      passive: true
    })
  }
}

onMounted(() => {
  document.readyState !== 'loading' ? initHeader() : document.addEventListener('DOMContentLoaded', initHeader)
})

onUnmounted(() => {
  document.removeEventListener('scroll', handleHeaderStyles)
  document.removeEventListener('DOMContentLoaded', initHeader)
})

</script>
